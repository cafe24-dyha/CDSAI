<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CDS AI Assistant</title>
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.5/dist/purify.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css"
      rel="stylesheet"
    />
    <script>
      // API 키는 서버에서 로드
      let OPENAI_API_KEY = "";
      let GOOGLE_CLIENT_ID = "";
      const DRIVE_FOLDER_ID = "0AP1E8jgbsh1ZUk9PVA";

      // 환경변수 로드
      async function loadEnvVars() {
        try {
          const response = await fetch("/api/config");
          const config = await response.json();
          OPENAI_API_KEY = config.OPENAI_API_KEY;
          GOOGLE_CLIENT_ID = config.GOOGLE_CLIENT_ID;
          loadGoogleAPI();
        } catch (error) {
          console.error("Error loading config:", error);
        }
      }

      // Google API 초기화
      function loadGoogleAPI() {
        if (!window.gapi) {
          console.error("Google API not loaded");
          return;
        }

        window.gapi.load("client:auth2", () => {
          window.gapi.client
            .init({
              clientId: GOOGLE_CLIENT_ID,
              scope:
                "https://www.googleapis.com/auth/drive.file https://www.googleapis.com/auth/spreadsheets",
              discoveryDocs: [
                "https://sheets.googleapis.com/$discovery/rest?version=v4",
                "https://www.googleapis.com/discovery/v1/apis/drive/v3/rest",
              ],
            })
            .then(() => {
              console.log("Google API initialized");
            })
            .catch((error) => {
              console.error("Error initializing Google API:", error);
            });
        });
      }

      // 페이지 로드 시 환경변수 로드
      window.onload = loadEnvVars;

      // ... 나머지 코드는 그대로 유지 ...
    </script>
  </head>
  <body>
    <!-- ... 기존 HTML 내용 ... -->
  </body>
</html>
